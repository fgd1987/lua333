
Wed Sep 16 23:00:23 CST 2015

socket不进行封装，写一个poll做IO，写协议的DECODER/ENCODER读写数据，DECODER/ENCODER里有数据缓存

lua模块

c模块
os.c 进行系统调用的封装
socket.c 做socket系统调用的封装

内部通信方法
1.用协程实现的调用，有返回值
    问题，如果在协程等待时，玩家还在接收消息，那实体状态就会改变，如扣钱等，怎么处理？
    可选，要不要锁住实体的状态

2.模块方法调用:不用实体接收，不可靠的，会丢失
3.实体方法调用:调用实体的方法，可靠的，而且保存数据库


协议:
1.protobuf做客端协议

数据库
1.MYSQL要做ORM, 描述文件用table表示
2.mongodb


Sat Sep 26 19:06:19 CST 2015
lua的makefile不会生成so,
需要修改src/Makefile
MYCFLAGS=-fPIC
+LUA_SO= liblua.so
ALL_T= $(LUA_A) $(LUA_T) $(LUAC_T) $(LUA_SO)
+$(LUA_SO): $(CORE_O) $(LIB_O)
+	$(CC) -o $@ -shared $?


Sat Sep 26 18:56:40 CST 2015
lua版本5.1.5， lua_newtable时会报下面的错
static int ltest(lua_State *L){
    printf("test\n");
    lua_newtable(L);
    return 1;
}
lua(1738,0x7fff7c37d300) malloc: *** error for object 0x1018bae60: pointer being freed was not allocated
*** set a breakpoint in malloc_error_break to debug




