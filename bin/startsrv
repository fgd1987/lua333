#!bin/lua

local srvname = arg[1]
local config_filepath = arg[2]

print('=================================')
print('       lua333 gamesrv            ')
print('=================================')

print(string.format('srvname(%s) config(%s)', srvname, config_filepath))

--加载配置文件
print('----------加载配置文件----------')
dofile(config_filepath)
print('----------引擎信息----------')
print(string.format('engine_path(%s)', Config.engine_path))

print('----------初始化环境----------')
package.path = string.format('%s/mod/?.lua;', Config.engine_path)..package.path
package.cpath = string.format('%s/lib/?.so;', Config.engine_path)..package.cpath
print(string.format('package.path(%s)', package.path))
print(string.format('package.cpath(%s)', package.cpath))

print('----------导入函数库----------')
--导入必须的c库
require('stringpatch')
require('bitpatch')
require('sys')
require('json')
require('ae')
require('ar')
require('redis')
require('mysql')
require('socket')
require('pbc')
require('sendbuf')
require('recvbuf')
require('select')
require('date')
--导入必须的lua库
require('mod.mod')
require('log.log')
--print('Config =')
--print(Json.encode(Config))

local srvconf = nil
for _, _srvconf in pairs(Config.srvlist) do
    if _srvconf.srvname == srvname then
        srvconf = _srvconf
        break
    end
end

if not srvconf then
    print(string.format('srvname(%s) not found', srvname))
    return
end

print(string.format('start %s', srvconf.srvname))

--加载模块
print('----------加载模块----------')
print(Json.encode(srvconf.mod))
for _, mod_path in pairs(srvconf.mod) do
    print(string.format('load mod(%s)', mod_path))
    Mod.load(mod_path)
    print(string.format('finish load mod(%s)', mod_path))
    print('')
end
Mod.call('test')
Mod.call('main')

Framesrv.mainloop()

